# Blog 历程

tags: blog

date: 2017-09-12 17:49

<abstract>
为什么写这个blog，和之间经历了什么。
<abstract>

[toc]

## 开始

刚开始是因为工作中的项目里有个RDP服务，就是一个转发服务。是用Java写的，之前的前端也都是Java程序员做完后台之后分别写的，然后拼起来一个网站的。

后来老大说，你们前端都在搞node，那这个转发服务器之后也交给你们来搞好了。

我就说，我来试试。

之后老大说，要实现1234等功能才可以，我就去看了看。当时的我非常小白，连AJAX请求怎么来的，服务器是怎么运行的（表面的知识的那种），端口号是什么都不知道。

就在每天写完自己的页面之后就去找老大问东问西的，现在简直不能想想……老大居然也能给这样的小白一点点的解释半个小时之类的，😓。

我自己也特别想做一个服务器，因为这样就能自己测AJAX了。这个是我当时培训班刚毕业的时候（对，我就是培训班出来的），非常想作的一件事，因为当时没有任何基础，学Javascript和BOM等都很吃力，老师是用的Apache和PHP做的演示，而且很快，我到最后也不知道怎么搭一个服务器，静态的那种都不行。后来简直就是一块心病了。但是还是知道一点跨域的知识的，当初入职的时候，还问了老大公司是怎么处理这个问题的，他说后台处理，我就放心了……

从最基础的静态服务器开始。因为这个RDP首先是一个前端的静态服务器，我们的网站就是差不多一个半静态的网站，页面都是一个个写好的，然后点击一个按钮，加载对应的数据，渲染，完事。这个很简单，直接用`express`的`static`就可以了。这个时候，我已经会写一个简单的静态资源服务器了，可能没那么健全，骨架还是会的。

第二个是请求转发，就是跨域的问题。这个当时也知道是怎么写的，就用`request`这个包，转发请求，然后把结果直接用`express`返回给前端就行了。

第三个是支持各种定制的`header`，这个是因为公司前端业务需要。这里有一个小坑，之后也没什么，但是造成的后果就是代码比较难看。坑就是HTTP协议里，header的key是不要求大小写的。但是浏览器和Java都在中划线的前后都首字母大写了，node就没有使用这个看似大家都在用的东西。于是，从前端拿到的header要用小写的去找，判断，然后转发的时候，还要用答大写的。

第四个是支持证书。这个有两个需求，一个是访问，一个是认证。一般来说访问是没有任何问题的。但是跟我们打交道的对方的服务器，不是一般的大家都访问的那种，他们只要求数据被加密了，不需要大家都认可的那种证书。这个也很简单，就是把自己的RDP server设置为不检查证书的CA合法性就可以了。第二个需求是要求能转发双向认证的请求。这个对我来说，又是一个新坑，我就去慢慢爬，最后搞定了，这个证书还是非认证CA颁发的证书，但是也无所谓了。HTTPS

这个东西我从demo到写完，用了两个月的时间。现在看来，如果有文档，加上测试，最多三天的事情……。但是这个事情让我觉得，自己能写一个网站了。我就又拾起了当初学完前端的一个梦想，自己写个Blog。

## 开始建站

毕业之后，水各种群的时候，看到别人动不动就自己写了一个网站，特别羡慕。而且作为一个前端，对后端知识一点都不了解的话，真的跟大家没什么可聊的。而且我之后发现，那些专职的稍微厉害点的前端，能给一个小型的初创公司（非互联网型的）做整个公司的技术支持都没问题。从前端到后端到服务器到数据库都懂的那种，特别羡慕。而且还有说，没必要折腾啦，这些都都是已经折腾过的了，他们知道他们需要什么。而真的是小白的时候，你的视野特别小，你根本没的选，虽然折腾到最后，你还是选择了最简单的那种，但是你知道了那些是什么，为什么不行，以后想用的话查查文档，几天就能搞定一个事情。

之前完我用`hexo`弄了一个静态的，各种坑一个个的爬（现在看是很简单，甚至能实现一个简单的，但是当时真的爬了很多坑）。爬完坑之后，还是觉得不爽，各种想要定制，但是静态的就是静态的，定制能力太低了。这个也就搁置了。

RDP的证书搞定之后，我也想弄个HTTPS玩玩，因为之前翻墙的原因，我买了一个VPS，虽然只有512Mhz／1核的cpu，但是只跑一个SS还是太浪费了。反正是种种原因吧，这个坑就这样开始挖了。

从过年开始，一点点的拼凑一点点的写。

### 准备

开始打算的是要实验各种新的东西，比如：
- 不使用Bootstrap。~~这个真的是自己坑自己~~因为日常工作中已经在使用了。最初选择的是semanticUI，因为偶尔听到别人说这个不错。
- 尽量不使用jQuery，遇到的尽量原生写出来。于是一个文件里面有$.get，有XMLHttpRequest，有fetch……
- 使用新的流行的数据库mongodb，因为之前使用过mysql，sqlite了。
- 本来是想用koa的，但是当时看协程好吃力，就还是用了express
- 尽量全部使用ES6+的API

### 说说

最先想到的是做一个类似于QQ的说说。我也不知道为什么，可能是当时有很多想说的，但是又不想使用QQ吧。

于是就开始倒腾`File Reader API`，`Canvas`，`FormData`，`Fetch API`做前端的图片压缩上传。没有产品样式，想到什么写什么，精力各种分散，想到什么就做什么，各种小Demo。再加上第一个摸索后端，各种坑一点点的填。

各种新东西想到就上，一点也不在乎兼容性，只测了最新版的Chrome和Firefox。

图片压缩上传坑爬了很久，使用的是base64，但是最后的效果还是不理想。base64是一个公式，但是怎么还有兼容性……一张图片在不同浏览器下的base64长度不同居然。而且base64长度跟图片大小并没有什么正相关性，这个是看了base64编码规则之后知道的，并且试着写了一个encode，decode太难了，没写出来，就继续弄这个了（又是转移注意力）。导致最后计算压缩比率的时候，居然有负值。

还想带上天气信息，因为QQ也带了不是。

于是去找了几个免费的天气API，最后发现，要根据IP地址确定城市，根据城市查询天气信息，这一套集成的最方便的是心知天气。当时想太多，还想着后台定时去查天气信息，每天查询4-8次，把天气信息存到数据库，这样可以限制自己对天气API的调用。因为预计我会调用两个城市的天气信息，如果有其他人访问的时候，这个免费的账户就撑不住了。后来证明，我这个不做SEO的网站真的是想多了🤣。

新版的就直接调用了没有做数据库缓存。而且现在使用的是hot-reloader，会经常刷新，但是还是没有达到免费API的上限。

说说部分还想添加权限控制，比如某些特殊字符代表了这个说说是隐私说说啊什么的。

现阶段用cookie控制权限，了解了一点secure和http only，知道了一点安全相关的。也觉得这个不安全，但是我这个东西没人hack的吧，也没什么重要信息。但是安全方便还是加入了考虑，因为知道一点总是好的嘛。现在在写第二版的时候，想到了IP黑名单和IP访问频率控制，SCP策略，session什么的再看吧。

### blog

blog比较折腾，想使用markdown。
