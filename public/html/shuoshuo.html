<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>shuoshuo</title>

    <style>
        #shuoshuo-ul li {
            border: 1px solid #666;
            border-radius: 4px;
            padding: 3px;
            margin-bottom: 5px;
            background-color: #fffcf4;
        }
    </style>
    <script src="../lib/jquery-3.1.1.js"></script>
    <script src="../lib/moment-2.17.1.js"></script>
    <script src="../lib/semantic/dist/semantic.min.js"></script>
    <link rel="stylesheet" href="../lib/semantic/dist/semantic.min.css">
</head>
<body style="padding: 30px;">
<div class="ui container">
    <div class="ui grid">
        <section class="six wide column">
            <h2>日期</h2>
            <ul>
                <li>2017</li>
                <li>2016</li>
                <li>2015</li>
                <li>2014</li>
            </ul>
        </section>
        <article class="ten wide column">
            <div class="ui fluid massive icon input">
                <textarea
                        style="padding: 0.5em;border-radius: 4px;border: 1px solid rgba(34, 36, 38, 0.15);overflow: scroll;height: 64px;max-width: 100%;max-height: 64px;margin: 0; resize: none;outline: 0;flex: 1 0 auto;line-height: 1em;"></textarea>
                <button onclick="document.querySelector('input[type=\'file\']').click()"><input type="file" hidden><i
                        class="icon image"></i></button>
                <button><i class="send icon"></i></button>
            </div>
            <p id="weather"></p>
            <ul id="shuoshuo-ul">

            </ul>
            <p>
                <button style="
    padding: 5px 10px;
    width: 100%;
    border: 1px;
    cursor: pointer;
    outline: none;" onclick="loadMore()">更多
                </button>
            </p>
            <a href="#"
               style="width: 30px; height: 30px; text-decoration: none;position: fixed; right: 20px; bottom: 30px; background-color:#61FF61;">top</a>
        </article>
    </div>
</div>

</body>
</html>
<script>
    let timeMark = 0;
    let index = 0;
//    let location = '';
    let vistorInfo = {};
    $(function () {
        $.ajax({
            url: '/getShuoshuoList',
            method: 'POST',
            data: {limit: 20}
        }).done(function (res) {
            let st = '';
            res.forEach(function (v, i) {
                let im = '';
//                v.img.forEach(function (iv) {
//                    im += `<img style="width: 200px;" src="${iv}">`
//                });
                st += `<li>${i + 1}: <time>${v.dateStr}</time><p>${v.content}</p><p>${im}</p><p>${v.weather}</p><p>${v.isPublic}</p></li>`;
                if (i === res.length - 1) {
                    timeMark = v.date;
                }
            });
            index = res.length;
            $('#shuoshuo-ul').html(st);

        }).fail(function (jqxhr) {
            $('#shuoshuo-ul').html(`<p>${jqxhr.status}: ${jqxhr.responseText}</p>`)
        });


        $.ajax({
            method: 'POST',
            url: '/getWeather'
        }).done(function (d) {
            $('#weather').html(`${d.location}: <img src="./assert/weather-icon/${d.code_day}.png"> ~ <img src="./assert/weather-icon/${d.code_night}.png">${d.code_day === d.code_night ? d.text_day : d.text_day + ' 转 ' + d.text_night} ${d.low}&#8451; ~ ${d.high}&#8451; <small>timestamp: ${moment(d.queryTime).format('YYYY-MM-DD HH:mm:ss')}</small>`);
            //<img src="${d.icon}"
        }).fail(function (e) {
            $('#weather').html(e.responseText)
        });

        $.ajax({
            url: ''
        })

    });
    let loadMore = function () {
        $.ajax({
            url: '/getShuoshuoList',
            method: 'POST',
            data: {time: timeMark}
        }).done(function (res) {
            if (!res.length) {
                alert('就这么多啦～～')
            }
            let st = '';
            res.forEach(function (v, i) {
                let im = '';
//                v.img.forEach(function (iv) {
//                    im += `<img style="width: 200px;" src="${iv}">`
//                });
                index++;
                st += `<li>${index}: <time>${v.dateStr}</time><p>${v.content}</p><p>${im}</p><p>${v.weather}</p><p>${v.isPublic}</p></li>`;
                if (i === res.length - 1) {
                    timeMark = v.date;
                }
            });
            $('#shuoshuo-ul').append(st);
        }).fail(function (xhr) {
            $('#shuoshuo-ul').append(`<p>${xhr.status}: ${xhr.responseText}</p>`);
        })
    };
    let postShuoshuo = function () {

    }

</script>